<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Net.Create Template Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/@json-editor/json-editor@latest/dist/jsoneditor.min.js"></script>
    <script src="./polyfills/assign.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>
    <link rel='stylesheet' id='theme-link'>
    <link rel='stylesheet' id='iconlib-link'>
</head>
<body>
<div class='container grid-xl'>
    <div class="row columns md:flex">
        <div class='col-8 col-md-8 w-8/12'>
            <h1>Net.Create Template Editor</h1>
            <p>Setup your template below, and then copy the text from the right into your template file.</p>
            <div id="json-editor-form"></div>
        </div>
        <div class='col-4 col-md-4 w-4/12'>
            <div>
                <a class="btn btn-primary" id="direct-link" title="preserves schema, value, and options">Direct Link</a>
                <a class="btn btn-secondary" href="?" title="reload editor with default example settings">reset</a>
            </div>
            <h2>JSON Output</h2>
            <p>You can also make changes to the JSON here and set the value in the editor by clicking "Update Form"</p>
            <label for="output-textarea"></label>
            <button class='btn btn-primary btn-block' id='setvalue'>Update Form</button>
            <textarea id='output-textarea' rows="15" style="width: 100%; font-family: monospace;"
                      class='form-control'></textarea>
             <p>
               <button class='btn btn-block' id='downloadTemplate'>Download Template</button>
              </p>
            <h2>Validation</h2>
            <label for="validate-textarea">This will update whenever the form changes to show validation errors if there
                are any.</label><br>
            <textarea id='validate-textarea' readonly disabled class='form-control'></textarea>
            <h2>Options</h2>
            <div>
                <label for="boolean-options-select">Boolean options</label><br>
                <select multiple size="15" id="boolean-options-select" class="form-control browser-default">
                    <option value='required_by_default'>Object properties required by default</option>
                    <option value='display_required_only'>Only show required properties by default</option>
                    <option value='show_opt_in'>Show optional properties (with checkbox)</option>
                    <option value='no_additional_properties'>No additional object properties</option>
                    <option value='ajax'>Allow loading schemas via Ajax</option>
                    <option value='disable_edit_json'>Disable "Edit JSON" buttons</option>
                    <option value='disable_collapse'>Disable collapse buttons</option>
                    <option value='disable_properties'>Disable properties buttons</option>
                    <option value='disable_array_add'>Disable array add buttons</option>
                    <option value='disable_array_reorder'>Disable array move buttons</option>
                    <option value='disable_array_delete'>Disable array delete buttons</option>
                    <option value='enable_array_copy'>Add copy buttons to arrays</option>
                    <option value='array_controls_top'>Array controls will be displayed at top of list</option>
                    <option value='disable_array_delete_all_rows'>Disable array delete all rows buttons</option>
                    <option value='disable_array_delete_last_row'>Disable array delete last row buttons</option>
                </select>
            </div>
            <div>
                <label for="theme-select">theme</label><br>
                <select id='theme-select' name="theme" class='form-control browser-default'>
                    <option value='barebones'>Barebones</option>
                    <option value='bootstrap3'>Bootstrap 3</option>
                    <option value='bootstrap4'>Bootstrap 4</option>
                    <option value='html'>HTML</option>
                    <option value='spectre'>Spectre</option>
                    <option value='tailwind'>Tailwind</option>
                </select>
            </div>
            <div>
                <label for="iconlib-select">iconlib</label><br>
                <select id='iconlib-select' name="iconlib" class='form-control browser-default'>
                    <option value='fontawesome3'>fontawesome 3</option>
                    <option value='fontawesome4'>fontawesome 4</option>
                    <option value='fontawesome5'>fontawesome 5</option>
                    <option value='jqueryui'>jQuery UI</option>
                    <option value='spectre'>Spectre</option>
                </select>
            </div>
            <div>
                <label for="object-layout-select">Object Layout</label><br>
                <select id='object-layout-select' class='form-control browser-default'>
                    <option value='normal'>normal</option>
                    <option value='grid'>grid</option>
                </select>
            </div>
            <div>
                <label for="show-errors-select">Show Errors</label><br>
                <select id='show-errors-select' class='form-control browser-default'>
                    <option value='interaction'>On Interaction</option>
                    <option value='change'>On Field Change</option>
                    <option value='always'>Always</option>
                    <option value='never'>Never</option>
                </select>
            </div>
            <div>
                <label for="lib-select"
                       title="It's recommended that you click the Direct Link after changing these options">Include
                    External Library</label><br>
                <select multiple size="10" id='lib-select' class='form-control browser-default'
                        title="It's reccomended that you click the Direct Link after changing these options">
                    <option value='ace_editor'>Ace Editor</option>
                    <option value='choices'>Choices</option>
                    <option value='sceditor'>SCEditor</option>
                    <option value='simplemde'>SimpleMDE</option>
                    <option value='select2'>Select2</option>
                    <option value='selectize'>Selectize</option>
                    <option value='flatpickr'>Flatpickr</option>
                    <option value='signature_pad'>Signature Pad</option>
                    <option value='mathjs'>Math.js</option>
                    <option value='cleavejs'>Cleave.js</option>
                </select>
            </div>
        </div>
    </div>
    <!-- Temporarily hidden so that we can still use it for tinkering, but hide from users ... need to re-set the CSS also to make it work-->
    <div class="row columns md:flex" hidden=true>
        <div class='col-12 col-md-12 w-12/12'>
            <h2>Schema</h2>
            <label for="schema-textarea">You can change the schema and see how the generated form looks. After you make
                changes, click "Update Schema"</label>
            <button class='btn btn-primary btn-block' id='setschema'>Update Schema</button>
            <textarea id='schema-textarea' rows="30" style="width: 100%; font-family: monospace;"
                      class='form-control'></textarea>
        </div>
    </div>
</div>
<script>

  var defaultSchema = {
  "$id": "https://example.com/arrays.schema.json",
  "$schema": "t",
  "title": "Net.Create Template",
  "description": "This will be your Net.Create Template",
  "type": "object",
  "properties": {
    "name": {
      "type": "string",
      "description": "Graph Name",
      "minLength": 4,
      "default": "Default Graph Name"
    },
    "description": {
      "type": "string",
      "description": "Graph Description for Tooltip",
      "minLength": 4,
      "default": "Default Graph Description"
    },
    "_comments": {
      "type": "string",
      "format": "textarea",
      "description": "This text doesn't impact the interface, and is only for those who read thee template directly.",
      "default": "This template was created via the template editor tool. "
    },
    "searchColor": {
      "type": "string",
      "format": "color",
      "default": "#FFa500"
    },
    "sourceColor": {
      "type": "string",
      "format": "color",
      "default": "#008800"
    },
    "requireLogin": {
      "type": "boolean",
      "format": "checkbox",
      "default": false
    },
    "citationPrompts": {
      "description": "Citation Prompts Description",
      "options": {
        "collapsed": true
      },
      "required": [
        "citation",
        "hidden"
      ],
      "properties": {
        "citation": {
          "type": "string",
          "description": "Citation Text for the Cite Button for a node",
          "minLength": 4,
          "default": "From My NetCreate Graph"
        },
        "hidden": {
          "type": "boolean",
          "format": "checkbox",
          "default": false
        }
      }
    },
    "nodePrompts": {
      "description": "Node Prompts Description",
      "options": {
        "collapsed": true
      },
      "type": "object",
      "properties": {
        "defaultTransparency": {
          "type": "number",
          "default": "0.1"
        },
        "label": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Label"
            },
            "help": {
              "type": "string",
              "default": "A short title for the node."
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            },
            "duplicateWarning": {
              "type": "string",
              "default": "You’re entering a duplicate node.  Do you want to View the Existing node, or Continue creating?"
            },
            "sourceNodeIsLockedMeessage": {
              "type": "string",
              "default": "This node is currently being edited by someone else, please try again later."
            }
          }
        },
        "type": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Type"
            },
            "help": {
              "type": "string",
              "default": "Node type, see below."
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            },
            "options":{
              "type": "array",
              "items": {
                "$ref": "#/definitions/nodeType"
              }
            }
          }
        },
        "degrees": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "number"
            },
            "label": {
              "type": "string",
              "default": "Degrees"
            },
            "help": {
              "type": "string",
              "default": "Number of edges"
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "notes": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Notes"
            },
            "help": {
              "type": "string",
              "default": "Add some notes."
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "info": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Info"
            },
            "help": {
              "type": "string",
              "default": "Add some info."
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "updated": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "description": "updated is included in the edge tables if in admin mode, and in the graph tooltip  if indicated here. Probably those should be more consistent.",
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Last Update"
            },
            "includeInGraphTooltip": {
              "type": "boolean",
              "format": "checkbox",
              "default": true
            }
          }
        },
        "delete": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "hidden"
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        }
      }
    },
    "edgePrompts": {
      "type": "object",
      "description": "Edge Prompts Description",
      "options": {
        "collapsed": true
      },
      "properties": {
        "defaultTransparency": {
          "type": "number",
          "default": "0.3"
        },
        "edgeIsLockedMessage": {
          "type": "string",
          "default": "This edge is currently being edited by someone else, please try again later."
        },
        "source": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "node"
            },
            "label": {
              "type": "string",
              "default": "Source"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "type": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "select"
            },
            "label": {
              "type": "string",
              "default": "Type"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            },
            "options":{
              "type": "array",
              "items": {
                "$ref": "#/definitions/edgeType"
              }
            }
          }
        },
        "target": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "node"
            },
            "label": {
              "type": "string",
              "default": "Target"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "notes": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Notes"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "info": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Info"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "citation": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Citation"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": false
            }
          }
        },
        "category": {
          "type": "object",
          "options": {
            "collapsed": true
          },
          "properties": {
            "type": {
              "type": "string",
              "default": "string"
            },
            "label": {
              "type": "string",
              "default": "Category"
            },
            "help": {
              "type": "string",
              "default": ""
            },
            "hidden":{
              "type": "boolean",
              "format": "checkbox",
              "default": true
            }
          }
        }
      }
    }
  },
  "definitions": {
    "nodeType": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "color": {
          "type": "string",
          "format": "color"
        }
      }
    },
    "edgeType": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "label": {
          "type": "string"
        },
        "color": {
          "type": "string",
          "format": "color"
        }
      }
    }
  }
}

  // parse url -> merge options -> refreshUI() -> initJsoneditor() -> direct link

  /* ------------------------------------------------------------------- data */

  var data = {}

  var defaultOptions = {
    iconlib: 'fontawesome5',
    object_layout: 'normal',
    schema: defaultSchema,
    show_errors: 'interaction',
    theme: 'bootstrap4'
  }

  var jsoneditor = null
  var directLink = document.querySelector('#direct-link')

  var booleanOptionsSelect = document.querySelector('#boolean-options-select')
  var head = document.getElementsByTagName('head')[0]
  var iconlibSelect = document.querySelector('#iconlib-select')
  var iconlibLink = document.querySelector('#iconlib-link')
  var libSelect = document.querySelector('#lib-select')
  var jsonEditorForm = document.querySelector('#json-editor-form')
  var objectLayoutSelect = document.querySelector('#object-layout-select')
  var outputTextarea = document.querySelector('#output-textarea')
  var schemaTextarea = document.querySelector('#schema-textarea')
  var setSchema = document.querySelector('#setschema')
  var setValue = document.querySelector('#setvalue')
  var downloadTemplate = document.querySelector('#downloadTemplate')
  var showErrorsSelect = document.querySelector('#show-errors-select')
  var themeSelect = document.querySelector('#theme-select')
  var themeLink = document.querySelector('#theme-link')
  var validateTextarea = document.querySelector('#validate-textarea')

  /* -------------------------------------------------------------- parse url */

  var parseUrl = function () {
    var url = window.location.search
    var queryParamsString = url.substring(1, url.length)
    var queryParams = queryParamsString.split('&')

    if (queryParamsString.length) {
      queryParams.forEach(function (queryParam) {
        var splittedParam = queryParam.split('=')
        var param = splittedParam[0]
        var value = splittedParam[1]

        // data query param
        if (param === 'data') {
          // compress schema and value
          try {
            data = JSON.parse(LZString.decompressFromBase64(value))
          } catch (reason) {
          }
        }
      })
    }

    mergeOptions()
  }

  /* ----------------------------------------------------------- mergeOptions */

  var mergeOptions = function () {
    data.options = Object.assign(defaultOptions, data.options)
    refreshUI()
  }

  /* -------------------------------------------------------------- refreshUI */

  var refreshUI = function () {
    // schema
    //schemaTextarea.value = JSON.stringify(data.options.schema, null, 2)

    // theme
    var themeMap = {
      barebones: '',
      bootstrap3: 'https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css',
      bootstrap4: 'https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css',
      html: '',
      spectre: 'https://unpkg.com/spectre.css/dist/spectre.min.css',
      tailwind: 'https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css'
    }
    themeLink.href = themeMap[data.options.theme]
    themeSelect.value = data.options.theme

    // iconlLib
    var iconLibMap = {
      fontawesome3: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css',
      fontawesome4: 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css',
      fontawesome5: 'https://use.fontawesome.com/releases/v5.6.1/css/all.css',
      jqueryui: 'https://code.jquery.com/ui/1.10.3/themes/south-street/jquery-ui.css',
      spectre: 'https://unpkg.com/spectre.css/dist/spectre-icons.min.css'
    }
    iconlibLink.href = iconLibMap[data.options.iconlib]
    iconlibSelect.value = data.options.iconlib

    // object_layout
    objectLayoutSelect.value = data.options.object_layout

    // show_errors
    showErrorsSelect.value = data.options.show_errors

    // boolean values
    var booleanOptions = booleanOptionsSelect.children
    for (var i = 0; i < booleanOptions.length; i++) {
      var booleanValue = booleanOptions[i]
      if (data.options[booleanValue.value]) {
        booleanValue.selected = true
      }
    }

    // libs
    var libMapping = {
      ace_editor: {
        js: [
          'https://cdn.jsdelivr.net/npm/ace-editor-builds@1.2.4/src-min-noconflict/ace.js'
        ],
        css: []
      },
      choices: {
        js: [
          'https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js'
        ],
        css: [
          'https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css'
        ]
      },
      cleavejs: {
        js: [
          'https://cdn.jsdelivr.net/npm/cleave.js@1.4.7/dist/cleave.min.js'
        ],
        css: []
      },
      sceditor: {
        js: [
          'https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js',
          'https://cdn.jsdelivr.net/npm/sceditor@2.1.3/minified/sceditor.min.js',
          'https://cdn.jsdelivr.net/npm/sceditor@2.1.3/minified/formats/bbcode.js',
          'https://cdn.jsdelivr.net/npm/sceditor@2.1.3/minified/formats/xhtml.js'
        ],
        css: [
          'https://cdn.jsdelivr.net/npm/sceditor@2.1.3/minified/themes/default.min.css'
        ]
      },
      simplemde: {
        js: [
          'https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js'
        ],
        css: [
          'https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css'
        ]
      },
      select2: {
        js: [
          'https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js',
          'https://cdn.jsdelivr.net/npm/select2@4.0.6-rc.1/dist/js/select2.min.js'
        ],
        css: [
          'https://cdn.jsdelivr.net/npm/select2@4.0.6-rc.1/dist/css/select2.min.css'
        ]
      },
      selectize: {
        js: [
          'https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/js/standalone/selectize.min.js'
        ],
        css: [
          'https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/css/selectize.min.css',
          'https://cdn.jsdelivr.net/npm/selectize@0.12.6/dist/css/selectize.default.min.css'
        ]
      },
      flatpickr: {
        js: [
          'https://cdn.jsdelivr.net/npm/flatpickr'
        ],
        css: [
          'https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css'
        ]
      },
      signature_pad: {
        js: [
          'https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js'
        ],
        css: []
      },
      mathjs: {
        js: [
          'https://cdn.jsdelivr.net/npm/mathjs@5.3.1/dist/math.min.js'
        ],
        css: []
      },
    }

    if (data.selectedLibs || data.unselectedLibs) {

      var booleanOptions = booleanOptionsSelect.children
      for (var i = 0; i < booleanOptions.length; i++) {
        var booleanValue = booleanOptions[i]
        if (data.options[booleanValue.value]) {
          booleanValue.selected = true
        }
      }

      var libSelectChildren = libSelect.children
      for (var i = 0; i < libSelectChildren.length; i++) {
        var child = libSelectChildren[i]
        child.selected = data.selectedLibs.includes(child.value)
      }

      // remove libraries
      data.unselectedLibs.forEach(function (selectedLib) {
        var concat = libMapping[selectedLib].js.concat(libMapping[selectedLib].css)
        concat.forEach(function () {
          var className = '.external_' + selectedLib
          var toRemove = head.querySelector(className)
          if (toRemove) {
            toRemove.parentNode.removeChild(toRemove)
          }
        })
      })

      // add libraries
      data.selectedLibs.forEach(function (selectedLib) {
        // add js
        libMapping[selectedLib].js.forEach(function (js) {
          var scriptElement = document.createElement('script')
          scriptElement.type = 'text/javascript'
          scriptElement.src = js
          scriptElement.async = false
          scriptElement.classList.add('external_' + selectedLib)
          head.appendChild(scriptElement)
        })
        // add css
        libMapping[selectedLib].css.forEach(function (css) {
          var linkElement = document.createElement('link')
          linkElement.setAttribute('rel', 'stylesheet')
          linkElement.setAttribute('type', 'text/css')
          linkElement.setAttribute('href', css)
          linkElement.classList.add('external_' + selectedLib)
          head.appendChild(linkElement)
        })
      })
    }

    initJsoneditor()
  }

  /* --------------------------------------------------------- initJsoneditor */

  var initJsoneditor = function () {
    // destroy old JSONEditor instance if exists
    if (jsoneditor) {
      jsoneditor.destroy()
    }

    // new instance of JSONEditor
    jsoneditor = new window.JSONEditor(jsonEditorForm, data.options)

    // listen for changes
    jsoneditor.on('change', function () {
      // output
      var json = jsoneditor.getValue()
      outputTextarea.value = JSON.stringify(json, null, 2)

      // validate
      var validationErrors = jsoneditor.validate()
      if (validationErrors.length) {
        validateTextarea.value = JSON.stringify(validationErrors, null, 2)
      } else {
        validateTextarea.value = 'valid'
      }
    })
    updateDirectLink()
  }

  /* ------------------------------------------------------- updateDirectLink */

  var updateDirectLink = function () {
    var url = window.location.href.replace(/\?.*/, '')
    url += '?data='
    url += LZString.compressToBase64(JSON.stringify(data))
    directLink.href = url
  }

  /* -------------------------------------------------------- event listeners */

  setValue.addEventListener('click', function () {
    jsoneditor.setValue(JSON.parse(outputTextarea.value))
  })

  downloadTemplate.addEventListener('click', function () {
    download("template.json", outputTextarea.value);
  })

  function download(filename, text) {
    var element = document.createElement('a');
    element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
    element.setAttribute('download', filename);

    element.style.display = 'none';
    document.body.appendChild(element);

    element.click();

    document.body.removeChild(element);
}
  setSchema.addEventListener('click', function () {
    try {
      data.options.schema = JSON.parse(data.options.schema)
    } catch (e) {
      alert('Invalid Schema: ' + e.message)
      return
    }
    refreshUI()
  })

  themeSelect.addEventListener('change', function () {
    data.options.theme = this.value || ''
    refreshUI()
  })

  iconlibSelect.addEventListener('change', function () {
    data.options.iconlib = this.value || ''
    refreshUI()
  })

  objectLayoutSelect.addEventListener('change', function () {
    data.options.object_layout = this.value || ''
    refreshUI()
  })

  showErrorsSelect.addEventListener('change', function () {
    data.options.show_errors = this.value || ''
    refreshUI()
  })

  booleanOptionsSelect.addEventListener('change', function () {
    var booleanOptions = this.children
    for (var i = 0; i < booleanOptions.length; i++) {
      data.options[booleanOptions[i].value] = booleanOptions[i].selected
    }
    refreshUI()
  })

  libSelect.addEventListener('change', function () {
    data.selectedLibs = []
    data.unselectedLibs = []

    var libs = this.children

    for (var i = 0; i < libs.length; i++) {
      if (libs[i].selected) {
        data.selectedLibs.push(libs[i].value)
      } else {
        data.unselectedLibs.push(libs[i].value)
      }
    }
    refreshUI()
  })

  parseUrl()

</script>
</body>
</html>
